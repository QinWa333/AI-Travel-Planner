# 🔄 升级指南

## 从旧版本升级到 v2.0

### 1. 更新代码

```bash
# 拉取最新代码
git pull origin main

# 或者如果你有本地修改
git stash
git pull origin main
git stash pop
```

### 2. 重新构建镜像

```bash
# 停止旧容器
docker-compose down

# 重新构建
docker-compose build

# 启动新容器
docker-compose up -d
```

### 3. 导出新镜像（可选）

如果需要分享给助教：

**Windows:**
```cmd
.\export-images.bat
```

**Mac/Linux:**
```bash
chmod +x export-images.sh
./export-images.sh
```

### 4. 验证升级

访问 http://localhost 检查：

- ✅ 首页行程卡片有城市图片
- ✅ 行程详情页是分屏布局（左地图右时间轴）
- ✅ 可以编辑和删除活动
- ✅ 地图上有标记点

## 新功能测试清单

### 首页测试
- [ ] 行程卡片显示城市图片
- [ ] 卡片悬停有阴影效果
- [ ] 天数标签显示正确
- [ ] 点击卡片跳转到详情页

### 行程详情页测试
- [ ] 左侧显示全屏地图
- [ ] 地图上有景点标记
- [ ] 点击标记显示信息窗口
- [ ] 右侧显示时间轴
- [ ] 活动卡片有编辑和删除按钮

### 编辑功能测试
- [ ] 点击"编辑"打开抽屉
- [ ] 修改信息后保存成功
- [ ] 地图和时间轴自动更新
- [ ] 删除活动后确认提示
- [ ] 删除成功后界面更新

### 地图功能测试
- [ ] 地图自动定位到目的地城市
- [ ] 所有景点都有标记
- [ ] 标记有编号和名称
- [ ] 点击标记显示详细信息
- [ ] 天数筛选功能正常

## 常见问题

### Q1: 升级后地图不显示？
**A:** 检查 `frontend/public/index.html` 中是否配置了高德地图 API Key。

### Q2: 图片加载很慢？
**A:** 图片来自 Unsplash CDN，首次加载可能较慢，后续会有缓存。

### Q3: 编辑活动后地图没更新？
**A:** 刷新页面，或者检查浏览器控制台是否有错误。

### Q4: 海外行程没有地图？
**A:** 这是正常的，高德地图主要支持中国境内地图。

### Q5: 旧数据兼容吗？
**A:** 完全兼容，不需要迁移数据。

## 回滚到旧版本

如果遇到问题需要回滚：

```bash
# 停止容器
docker-compose down

# 切换到旧版本
git checkout <旧版本tag>

# 重新构建
docker-compose build
docker-compose up -d
```

## 技术支持

如果遇到问题：

1. 查看日志：`docker-compose logs -f`
2. 检查浏览器控制台错误
3. 查看 GitHub Issues
4. 联系开发团队

---

**升级完成后记得测试所有功能！** 🎉
